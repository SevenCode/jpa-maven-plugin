<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Nov 23, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF8" />
    <title>Generating Elements in a persistence.xml File</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
      <meta name="author" content="Laird Nelson" />
    <meta name="Date-Creation-yyyymmdd" content="20110909" />
    <meta name="Date-Revision-yyyymmdd" content="20111123" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                JPA Maven Plugin
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2011-11-23</span>
                  &nbsp;| <span id="projectVersion">Version: 1.1-SNAPSHOT</span>
                      </div>
            <div class="xright">        
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="../rationale.html" title="Rationale">Rationale</a>
            </li>
                  <li class="none">
                          <a href="../plugin-info.html" title="Goals">Goals</a>
            </li>
                  <li class="none">
                          <a href="../usage.html" title="Usage">Usage</a>
            </li>
                  <li class="none">
                          <a href="../faq.html" title="FAQ">FAQ</a>
            </li>
          </ul>
                       <h5>Examples</h5>
                  <ul>
                  <li class="none">
            <strong>Generating <class> elements in a persistence.xml file</strong>
          </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                        <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Generating Elements in a <tt>.persistence.xml</tt> File<a name="Generating_Elements_in_a_.persistence.xml_File"></a></h2><div class="section"><h3>Summary<a name="Summary"></a></h3><p>The <tt>list-entity-classnames</tt> goal generates a <tt>.properties</tt> file in (usually) <tt>target/generated-test-sources/jpa-maven-plugin</tt> named (usually) <tt>entityClassnames.properties</tt>. What you do with this file is up to you. This example shows the most common thing to do with this file and is divided into two parts.</p><p>The first part shows the mechanics of generating the <tt>.properties</tt> file. The second part shows how one might make use of this <tt>.properties</tt> file and Maven filtering.</p></div><div class="section"><h3>Generating the <tt>.properties</tt> file<a name="Generating_the_.properties_file"></a></h3><div class="section"><h4>Generate the file using defaults<a name="Generate_the_file_using_defaults"></a></h4><p>To use the defaults, which are sensible for most simple persistence units, just do this:</p><div class="source"><pre>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>This will generate an <tt>entityClassnames.properties</tt> file in <tt>$<a name="project.build.directory">project.build.directory</a>/generated-test-sources/jpa-maven-plugin</tt> that looks something like this:</p><div class="source"><pre>entityClassnames = com.foobar.MyFirstEntity&lt;/class&gt;\n&lt;class&gt;com.foobar.MySecondEntity&lt;/class&gt;\n&lt;class&gt;com.foobar.MyThirdEntity</pre></div></div><div class="section"><h4>Customization<a name="Customization"></a></h4><p>To customize this goal, make sure to supply a <tt>&lt;configuration</tt>&gt; element in your <tt>&lt;execution</tt>&gt; element or directly beneath your <tt>&lt;plugin</tt>&gt; element. See the <a class="externalLink" href="http://maven.apache.org/guides/mini/guide-configuring-plugins.html">Guide to Configuring Plug-ins</a> for more general information.</p><div class="section"><h5>Customizing what is scanned<a name="Customizing_what_is_scanned"></a></h5><p>By default, the <tt>list-entity-classnames</tt> goal scans the <a class="externalLink" href="http://maven.apache.org/ref/3.0.3/maven-core/apidocs/org/apache/maven/project/MavenProject.html#getTestClasspathElements%28%29">test classpath</a>, which is normally that set up by the <a class="externalLink" href="http://maven.apache.org/plugins/maven-surefire-plugin/examples/configuring-classpath.html">Maven Surefire plugin</a>. This behavior can be customized by changing the set of URLs that is scanned.</p><p>To change the set of URLs that is scanned, add a <tt>&lt;URLs</tt>&gt; element to your configuration:</p><div class="source"><pre>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;URLs&gt;
          &lt;URL&gt;file:///foobar&lt;/URL&gt;
          &lt;URL&gt;file:${project.build.outputDirectory}&lt;/URL&gt;
        &lt;URLs&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>Remember that you can (and probably should) use Maven variables here (like <tt>$<a name="project.build.outputDirectory">project.build.outputDirectory</a></tt> or <tt>$<a name="settings.localRepository">settings.localRepository</a></tt>).</p><p>Also, remember that dependent <tt>.jar</tt> files (dependency artifacts) may contain some entities you need. By default these <tt>.jar</tt>s are included in the test classpath.</p><p>There is usually very little reason, if any, to customize the set of URLs being scanned.</p></div><div class="section"><h5>Customizing how the scan takes place<a name="Customizing_how_the_scan_takes_place"></a></h5><p>The <tt>jpa-maven-plugin</tt> makes use of the <a class="externalLink" href="http://scannotation.sourceforge.net/">Scannotation library</a> to locate classes that have certain annotations applied to them. You can customize the mechanism by which this scanning takes place by specifying the implementation of the <tt><a href="../apidocs/com/edugility/jpa/maven/plugin/AnnotationDB.html">AnnotationDB</a></tt> instance that performs the scanning:</p><div class="source"><pre>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;db&gt;
          &lt;ignoredPackages&gt;
            &lt;ignoredPackage&gt;junit&lt;/ignoredPackage&gt;
            &lt;ignoredPackage&gt;java&lt;/ignoredPackage&gt;
            &lt;ignoredPackage&gt;javax&lt;/ignoredPackage&gt;
            &lt;ignoredPackage&gt;org.apache.maven&lt;/ignoredPackage&gt;
            &lt;ignoredPackage&gt;org.apache.plexus&lt;/ignoredPackage&gt;
          &lt;/ignoredPackages&gt;
        &lt;/db&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>This customization relies on the rather sophisticated configuration mechanism brought to Maven by Plexus. Specifically, when a plugin parameter is an object, and not, say, a <tt>String</tt> or <tt>boolean</tt>, you can specify the implementation you would like Maven to use instead. You can configure that implementation using XML tags that represent its Java bean properties. So in the above example, we've caused the <tt><a class="externalLink" href="http://scannotation.sourceforge.net/apidocs/org/scannotation/AnnotationDB.html#setIgnoredPackages%28java.lang.String[]%29">setIgnoredPackages</a></tt> method to be called on the <tt>AnnotationDB</tt> instance represented by the <tt>&lt;db</tt>&gt; parameter. It follows that you can customize any public property of the <tt>AnnotationDB</tt> used to perform annotation scanning.</p></div><div class="section"><h5>Customize the <tt>.properties</tt> file contents<a name="Customize_the_.properties_file_contents"></a></h5><div class="section"><h6>Changing the <tt>defaultPropertyName</tt><a name="Changing_the_defaultPropertyName"></a></h6><p>You can change the default property name:</p><div class="source"><pre>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;defaultPropertyName&gt;allMyClasses&lt;/defaultPropertyName&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>The <tt>.properties</tt> file contents would now look like this:</p><div class="source"><pre>allMyClasses = com.foobar.MyFirstEntity&lt;/class&gt;\n&lt;class&gt;com.foobar.MySecondEntity&lt;/class&gt;\n&lt;class&gt;com.foobar.MyThirdEntity</pre></div></div><div class="section"><h6>Changing how packages are allocated to property names<a name="Changing_how_packages_are_allocated_to_property_names"></a></h6><p>In the case of multiple persistence units you might find that you want certain classes listed under different persistence units. To accomplish this, your first step needs to be customizing the way that auto-discovered persistent classes are allocated to property names.</p><p>By default, all classes are allocated to the property named by the value of the <tt><a href="../list-entity-classnames-mojo.html#defaultPropertyName">defaultPropertyName</a></tt> parameter. Technically, this value is the name of a property to use when no other property name could be determined.</p><p>To do this property name allocation, you need to customize the internal <tt>Map</tt> used to index property names by package fragments. Here, for example, is a configuration that uses package fragments to list classes under different property keys. The keys to the map are <i>package fragments</i>, not simple strings. That means that <tt>com.foobar</tt> is a valid property key (assuming there is a <tt>com.foobar</tt> package defined somewhere) but <tt>com.foob</tt> is not (assuming that there is <i>not</i> a <tt>com.foob</tt> defined somewhere).</p><p>The search is carried out from most specific package fragment to most general:</p><div class="source"><pre>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;defaultPropertyName&gt;dumpingGroundClasses&lt;/defaultPropertyName&gt;
        &lt;propertyNames&gt;
          &lt;com.foobar.animal&gt;animalClasses&lt;/com.foobar.animal&gt;
          &lt;com.foobar.people&gt;peopleClasses&lt;/com.foobar.people&gt;
          &lt;com.foobar.vehicle&gt;vehicleClasses&lt;/com.foobar.vehicle&gt;
          &lt;com.foobar&gt;generalClasses&lt;/com.foobar&gt;
          &lt;com&gt;otherClasses&lt;/com&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>The <tt>.properties</tt> file contents would look something like this:</p><div class="source"><pre>dumpingGroundClasses = Rock.class&lt;/class&gt;\n&lt;class&gt;org.fugly.FuglyEntity

animalClasses = com.foobar.animal.Chicken&lt;/class&gt;\n&lt;class&gt;com.foobar.animal.Cow

peopleClasses = com.foobar.people.Person

vehicleClasses = com.foobar.vehicle.Truck&lt;/class&gt;\n&lt;class&gt;com.foobar.vehicle.Car

otherClasses = com.bizbaw.SomeEntity</pre></div></div><div class="section"><h6>Changing the prefix and suffix<a name="Changing_the_prefix_and_suffix"></a></h6><p>You may have noticed the <tt>&lt;class</tt>&gt; and <tt>&lt;/class</tt>&gt; fragments decorating the property values. These are the prefix and suffix used to further add to the individual class names. Obviously whether you customize or eliminate these values depends on what you want to do with the <tt>.properties</tt> file. The defaults exist for the most common case of wanting to use this goal in conjunction with a <tt>persistence.xml</tt> file and Maven filtering (more on that later).</p><p>To change the prefix, provide the <tt>&lt;prefix</tt>&gt; parameter and the <tt>&lt;suffix</tt>&gt; with a value:</p><div class="source"><pre>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;prefix&gt;'Property name: '&lt;/prefix&gt;
        &lt;suffix&gt;'
'&lt;/suffix&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>The contents of the <tt>.properties</tt> file will now look (somewhat uselessly) like this:</p><div class="source"><pre>entityClassnames = com.foobar.simple.jpa.SimpleEntity\nProperty name \:com.edugility.simple.jpa.SimpleMappedSuperclass</pre></div><p>You may notice the single quotes (<tt>'</tt>) in the <tt>&lt;prefix</tt>&gt; and <tt>&lt;suffix</tt>&gt; elements. Due to <a class="externalLink" href="http://jira.codehaus.org/browse/MODELLO-256">http://jira.codehaus.org/browse/MODELLO-256</a>, leading and trailing whitespace in Maven plugin configuration elements is ignored.</p><p>The <tt>list-entity-classnames</tt> goal works around this severe bug by stripping (matching) leading quotation marks (single or double) that occur as the first and last characters in the <tt>&lt;prefix</tt>&gt;, <tt>&lt;suffix</tt>&gt;, <tt>&lt;firstItemPrefix</tt>&gt; and <tt>&lt;lastItemSuffix</tt>&gt; elements. This allows you to &quot;protect&quot; whitespace. (Please note that the usual standard mechanisms (<tt>CDATA</tt>, <tt>xml:space</tt> attribute, etc.) do not work.) If there are no such quotation marks, or if the <tt><a href="./list-entity-classnames-mojo.html#stripQuotes">stripQuotes</a></tt> parameter is set to <tt>false</tt>, then no substitution is performed.</p></div><div class="section"><h6>Changing the first and last prefix and suffix elements<a name="Changing_the_first_and_last_prefix_and_suffix_elements"></a></h6><p>In the example above, the first element, <tt>com.foobar.simple.jpa.SimpleEntity</tt>, does not have a prefix. You can set this prefix as well, and you can set the last item's suffix, too:</p><div class="source"><pre>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;firstItemPrefix&gt;'Here are the properties! Property name: '&lt;/firstItemPrefix&gt;
        &lt;prefix&gt;'Property name: '&lt;/prefix&gt;
        &lt;suffix&gt;'
'&lt;/suffix&gt;
        &lt;lastItemSuffix&gt;'
And that's a wrap!'&lt;/lastItemSuffix&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>This will produce:</p><div class="source"><pre>entityClassnames = Here are the properties! Property name\: com.foobar.simple.jpa.SimpleEntity\nProperty name \:com.edugility.simple.jpa.SimpleMappedSuperclass\nAnd that's a wrap!</pre></div><p>As you might expect, the <tt>firstItemPrefix</tt> and <tt>lastItemSuffix</tt> govern the &quot;wrapper&quot; prefix and suffix--the textual decorations that are applied to the list as a whole.</p><p>In practice, you will rarely change any of these parameters--at least for JPA testing purposes.</p></div></div></div></div><div class="section"><h3>Using the <tt>.properties</tt> file for Maven filtering<a name="Using_the_.properties_file_for_Maven_filtering"></a></h3><div class="section"><h4>Create a <tt>src/test/resources/META-INF/persistence.xml</tt> file<a name="Create_a_srctestresourcesMETA-INFpersistence.xml_file"></a></h4><p>Once you have a <tt>.properties</tt> file, the most productive thing to do with it is to use it to fill out the persistent class list that has to appear in your <tt>META-INF/persistence.xml</tt> file that you use for testing.</p><p>First, create this file in your <tt>src/test/resources</tt> directory. It should look something like this (modify what you need to; the important part is the <tt>$<a name="entityClassnames">entityClassnames</a></tt> reference):</p><div class="source"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence version=&quot;2.0&quot;
             xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;&gt;
  &lt;persistence-unit name=&quot;test&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
    &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;

    &lt;class&gt;${entityClassnames}&lt;/class&gt;

    &lt;properties&gt;
      &lt;property name=&quot;javax.persistence.jdbc.driver&quot; value=&quot;${testDatabaseDriverClass}&quot; /&gt;
      &lt;property name=&quot;javax.persistence.jdbc.url&quot; value=&quot;${testDatabaseConnectionURL}&quot; /&gt;
      &lt;property name=&quot;javax.persistence.jdbc.user&quot; value=&quot;${testDatabaseUser}&quot; /&gt;
      &lt;property name=&quot;javax.persistence.jdbc.password&quot; value=&quot;${testDatabasePassword}&quot; /&gt;

      &lt;property name=&quot;hibernate.default_schema&quot; value=&quot;${testDatabaseSchema}&quot; /&gt;
      &lt;property name=&quot;hibernate.id.new_generator_mappings&quot; value=&quot;true&quot;/&gt;
      &lt;property name=&quot;hibernate.show_sql&quot; value=&quot;${hibernateShowSql}&quot; /&gt;
      &lt;property name=&quot;hibernate.format_sql&quot; value=&quot;true&quot; /&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre></div><p>Please note that this is the <tt>persistence.xml</tt> file you'll use for <i>testing</i>, not the one you'll distribute with your application.</p><p>If you were to run <tt>mvn process-test-classes</tt> at this point, nothing very exciting would happen. Your <tt>.properties</tt> file would be generated, but it wouldn't be used in any way.</p><p>The Maven resource plugin's <tt><a class="externalLink" href="http://maven.apache.org/plugins/maven-resources-plugin/resources-mojo.html">resources:resources</a></tt> goal needs to have all its filters present at the time it is invoked, or it fails. Since we can't even produce our <tt>.properties</tt> file until at least the <tt>process-test-classes</tt> phase, we can't meet this condition. So filtering using the preconfigured project resources is out of the question.</p><p>That's OK, though, because the Maven resources plugin also has a <tt><a class="externalLink" href="http://maven.apache.org/plugins/maven-resources-plugin/copy-resources-mojo.html">copy-resources</a></tt> goal. That goal is fully configurable. So we will make use of it, and invoke it after we've generated our <tt>.properties</tt> file. Then we'll set it up so that it copies and filters our <tt>META-INF/persistence.xml</tt> file to where it should go, and it will be as though our list of entity classnames was just another Maven property that we used for filtering.</p><p>To start with, we need to exclude our test <tt>persistence.xml</tt> from standard Maven resource copying. Edit your <tt>pom.xml</tt> so that the <tt>&lt;build</tt>&gt; section's <tt>&lt;testResources</tt>&gt; element looks like this:</p><div class="source"><pre>  &lt;testResources&gt;
    &lt;testResource&gt;
      &lt;directory&gt;src/test/resources&lt;/directory&gt;
      &lt;filtering&gt;true&lt;/filtering&gt; &lt;!-- if you want filtering on by default, obviously --&gt;
      &lt;excludes&gt;
        &lt;exclude&gt;META-INF/persistence.xml&lt;/exclude&gt;
      &lt;/excludes&gt;
    &lt;/testResource&gt;
  &lt;/testResources&gt;</pre></div><p>Next, we need to explicitly use the <tt>maven-resources-plugin</tt>, so add a stanza for that in your <tt>&lt;build&gt;&lt;plugins</tt>&gt; area:</p><div class="source"><pre>  &lt;build&gt;
    &lt;plugins&gt;

      &lt;!-- various plugins, including the jpa-maven-plugin --&gt;

      &lt;!--
           ORDER IS IMPORTANT! The jpa-maven-plugin must come before
           the XML below.
      --&gt;

      &lt;plugin&gt;
        &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.5&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;Copy persistence.xml filtered with generated entityClassnames.properties file&lt;/id&gt;
            &lt;phase&gt;process-test-classes&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;copy-resources&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;filters&gt;
                &lt;filter&gt;${project.build.directory}/generated-test-sources/jpa-maven-plugin/entityClassnames.properties&lt;/filter&gt;
              &lt;/filters&gt;
              &lt;outputDirectory&gt;${project.build.testOutputDirectory}/META-INF&lt;/outputDirectory&gt;
              &lt;resources&gt;
                &lt;resource&gt;
                  &lt;filtering&gt;true&lt;/filtering&gt;
                  &lt;directory&gt;src/test/resources/META-INF&lt;/directory&gt;
                  &lt;includes&gt;
                    &lt;include&gt;persistence.xml&lt;/include&gt;
                  &lt;/includes&gt;
                &lt;/resource&gt;
              &lt;/resources&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;

    &lt;/plugins&gt;
  &lt;/build&gt;</pre></div><p>This bit of XML says that during the <tt>process-test-classes</tt> phase, Maven should copy the <tt>src/test/resources/META-INF/persistence.xml</tt> to <tt>target/test-classes/META-INF/persistence.xml</tt> and should filter it along the way with the contents of the <tt>entityClassnames.properties</tt> file we just generated.</p><p><b>A note on plugin ordering:</b> Maven plugins within the same phase execute in the order that they are declared. So because the <tt>maven-resources-plugin</tt> goal we've configured above uses the output of the <tt>jpa-maven-plugin</tt>'s <tt>list-entity-classnames</tt> goal, the configuration stanzas for the <tt>jpa-maven-plugin</tt> must appear first in your <tt>pom.xml</tt>. Alternatively, we could have configured the <tt>copy-resources</tt> goal to bind to the <tt>test</tt> phase, but that might run <i>after</i> the <tt>maven-surefire-plugin</tt>--which is going to run all our tests, after all--during the <tt>test</tt> phase. It's easier to put them both into <tt>test-classes</tt> and just to ensure that they're in the right order.</p></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2011
                        <a href="http://about.me/lairdnelson">Laird Nelson</a>.
            All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
