<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jan 7, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Laird Nelson" />
    <meta name="Date-Creation-yyyymmdd" content="20110910" />
    <meta name="Date-Revision-yyyymmdd" content="20130107" />
    <meta http-equiv="Content-Language" content="en" />
    <title>JPA Maven plugin - Rationale</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>JPA Maven Plugin</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-01-07</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 3-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Rationale</a>
          </li>
                  
      <li>
    
                          <a href="plugin-info.html" title="Goals">
          <i class="none"></i>
        Goals</a>
            </li>
                  
      <li>
    
                          <a href="usage.html" title="Usage">
          <i class="none"></i>
        Usage</a>
            </li>
                  
      <li>
    
                          <a href="faq.html" title="FAQ">
          <i class="none"></i>
        FAQ</a>
            </li>
                              <li class="nav-header">Examples</li>
                                
      <li>
    
                          <a href="examples/listClassElements.html" title="Generating <class> elements in a persistence.xml file">
          <i class="none"></i>
        Generating <class> elements in a persistence.xml file</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                            
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>Rationale<a name="Rationale"></a></h2><p>This project was created because I wanted to be able to create a bunch of JPA entities and to claim truthfully that they were:</p><ul><li><b>Specification compliant.</b> I didn't want to create <a class="externalLink" href="http://hibernate.org/">Hibernate</a>- or <a class="externalLink" href="http://www.eclipse.org/eclipselink/">EclipseLink</a>-specific entities, but <a class="externalLink" href="http://jcp.org/en/jsr/detail?id=317">JPA 2.0</a>-compliant entities.</li><li><b>Vendor tolerant.</b> Being specification-compliant is one thing; being specification-compliant and tolerant of vendors' shortcomings is another. I wanted my entities to be both.</li></ul><p>The only way to accomplish both objectives was through rigorous unit and integration testing.</p><p>While I was researching the best way to test these entities in a JPA environment, I had lots of different solutions suggested to me, not the least of which was the <a class="externalLink" href="http://www.jboss.org/arquillian/">Arquillian</a> project. <a class="externalLink" href="http://openejb.apache.org/">OpenEJB</a> was suggested to me as well.</p><p>But I didn't want to test my entities inside a Java EE container--my goal was not to test a Java EE solution. I wanted to test them in a POJO environment with as few layers as possible.</p><p>For that, I soon discovered this little fact in the JPA 2.0 specification:</p><dl><dt>8.2.1.6.4</dt><dd>[...] A <b>list of all named managed persistence classes must be specified</b> in Java SE environments to insure portability. Portable Java SE applications should not rely on the other mechanisms described here to specify the managed persistence classes of a persistence unit. Persistence providers may require that the set of entity classes and classes that are to be managed must be fully enumerated in each of the persistence.xml files in Java SE environments.</dd></dl><p>That means that in your <tt>persistence.xml</tt> you need a stanza like this:</p><div class="source"><pre class="prettyprint">  &lt;class&gt;com.mycompany.MyFirstEntity&lt;/class&gt;
  &lt;class&gt;com.mycompany.MySecondEntity&lt;/class&gt;
  &lt;class&gt;com.mycompany.MyThirdEntity&lt;/class&gt;
  &lt;!-- ... etc. ... --&gt;
  &lt;class&gt;com.mycompany.MyNinetyThirdEntity&lt;/class&gt;</pre></div><p>But even that isn't enough, because it turns out that depending on the vendor you also have to list all your mapped superclasses, <tt>@IdClass</tt>-annotated classes and <tt>@Embeddable</tt>s.</p><p>Oh, and you have to make sure that all the classes contained in dependent libraries that are embeddables, &quot;id classes&quot;, entities or mapped superclasses are also listed.</p><div class="section"><h3>Annotation processor!<a name="Annotation_processor"></a></h3><p>My first thought was to follow <a class="externalLink" href="http://weblogs.java.net/blog/ss141213/archive/2007/11/a_javac_plugin_1.html">Sahoo's lead</a> and to either use his annotation processor or write one suited to my needs. The first problem I found was that an annotation processor, unless it were very sophisticated, would not consider entities from dependent libraries on the classpath.</p><p>In addition, in order to preserve vendor leniency, it is often necessary to supply lots and lots of persistence properties in your <tt>persistence.xml</tt> as well. This one, for example:</p><div class="source"><pre class="prettyprint">  &lt;property name=&quot;hibernate.id.new_generator_mappings&quot; value=&quot;true&quot; /&gt;</pre></div><p>An annotation processor that generated the whole <tt>persistence.xml</tt> was not going to fit my needs.</p></div><div class="section"><h3>Maven filtering<a name="Maven_filtering"></a></h3><p>I began thinking about Maven filtering--the ability to have Maven substitute text <tt>${likeThis}</tt> with equivalently named properties. The <a class="externalLink" href="http://maven.apache.org/plugins/maven-resources-plugin/">Maven resources plugin</a>, I knew, has a <tt><a class="externalLink" href="http://maven.apache.org/plugins/maven-resources-plugin/copy-resources-mojo.html">copy-resources</a></tt> goal that can take a <tt>.properties</tt> file as a <a class="externalLink" href="http://maven.apache.org/plugins/maven-resources-plugin/copy-resources-mojo.html#filters">filter</a> source. So it seemed that all I really had to do was come up with a Maven plugin that would produce a <tt>.properties</tt> file whose properties' values were lists of classes.</p><p>(<a class="externalLink" href="https://github.com/ljnelson/jpa-maven-plugin/issues/3">Issue #3</a> provided the impetus to actually make this list of properties available to the rest of the build as well, and with its resolution you can now skip the <tt>.properties</tt> file altogether if you so desire, although in that case you have to figure out where in the Maven lifecycle you would like this plugin to fire, which is not an easy question to answer.)</p></div><div class="section"><h3>Exercises for the reader<a name="Exercises_for_the_reader"></a></h3><p>This plugin does exactly that: it manages the production of a <tt>.properties</tt> file whose properties' values are lists of class names. The names of the properties are customizable, as are the prefixes and suffixes around each element of the classname.</p><p>Filtering itself is left to other members of the Maven ecosystem. As a <a href="./examples/listClassElements.html">hint</a>, if you invoke the <tt>resources:copy-resources</tt> goal in the right place, and specify the <tt>.properties</tt> file that <i>this</i> plugin produces as one of its filters, then you can pull in the list of classnames this plugin produces like this:</p><div class="source"><pre class="prettyprint">  &lt;class&gt;${entityClassnames}&lt;/class&gt;</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2011-2013
                        <a href="http://about.me/lairdnelson">Laird Nelson</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
