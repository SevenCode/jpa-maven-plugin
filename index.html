<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Jpa-maven-plugin by ljnelson</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Jpa-maven-plugin</h1>
        <p>A Maven 3 plugin for helping out with common JPA project needs.</p>

        <p class="view"><a href="https://github.com/ljnelson/jpa-maven-plugin">View the Project on GitHub <small>ljnelson/jpa-maven-plugin</small></a></p>


        <ul>
          <li><a href="https://github.com/ljnelson/jpa-maven-plugin/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ljnelson/jpa-maven-plugin/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ljnelson/jpa-maven-plugin">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>jpa-maven-plugin</h1>

<p>This project houses a <a href="http://maven.apache.org/guides/plugin/guide-java-plugin-development.html">Maven plugin</a> for performing various tasks
to help with JPA-based projects.</p>

<h2>Quick Start</h2>

<p>Create a <code>persistence.xml</code> to be used for unit testing in
<code>src/test/resources/META-INF</code>:</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.0"
             xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;
  &lt;persistence-unit name="test-Hibernate" transaction-type="RESOURCE_LOCAL"&gt;

    &lt;!-- This provider is just an example. --&gt;
    &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;

    &lt;!-- This is where the magic will happen. --&gt;
    &lt;class&gt;${entityClassnames}&lt;/class&gt;

    &lt;properties&gt;
      &lt;property name="javax.persistence.jdbc.driver" value="TODO: JDBC driver class name goes here" /&gt;
      &lt;property name="javax.persistence.jdbc.url" value="TODO: JDBC connection URL for unit tests goes here" /&gt;
      &lt;property name="javax.persistence.jdbc.user" value="TODO: unit test database user goes here" /&gt;
      &lt;property name="javax.persistence.jdbc.password" value="TODO: unit test database password goes here" /&gt;

      &lt;!-- You may of course put any properties you want here --&gt;
      &lt;property name="hibernate.default_schema" value="TODO: default test schema goes here" /&gt;
      &lt;property name="hibernate.id.new_generator_mappings" value="true"/&gt;
      &lt;property name="hibernate.show_sql" value="true" /&gt;
      &lt;property name="hibernate.format_sql" value="true" /&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;
</code></pre>

<p>Ensure that it does <em>not</em> get copied during resource copying.  Add
this in your <code>pom.xml</code>'s <code>&lt;build&gt;</code> section:</p>

<pre><code>&lt;testResources&gt;
  &lt;testResource&gt;
    &lt;directory&gt;src/test/resources&lt;/directory&gt;
    &lt;excludes&gt;
      &lt;exclude&gt;META-INF/persistence.xml&lt;/exclude&gt;
    &lt;/excludes&gt;
    &lt;!-- Whether you want to filter the other test resources is up to you --&gt;
    &lt;filtering&gt;true&lt;/filtering&gt;
  &lt;/testResource&gt;
&lt;/testResources&gt;
</code></pre>

<p>Now set up the <code>jpa-maven-plugin</code>.  Place this in your <code>pom.xml</code>'s
<code>&lt;build&gt;</code>'s <code>&lt;plugins&gt;</code> section:</p>

<pre><code>&lt;plugin&gt;
  &lt;groupId&gt;com.edugility&lt;/groupId&gt;
  &lt;artifactId&gt;jpa-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.1-SNAPSHOT&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Generate entityClassnames.properties&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;list-entity-classnames&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>

<p>Finally, make sure that the <code>persistence.xml</code> is copied over, but only
after the <code>jpa-maven-plugin</code> has run.  Place this <strong>IMMEDIATELY
BELOW</strong> the plugin stanza listed above:</p>

<pre><code>&lt;plugin&gt;
  &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.5&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;Copy persistence.xml filtered with generated entityClassnames.properties file&lt;/id&gt;
      &lt;phase&gt;process-test-classes&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;copy-resources&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;filters&gt;
          &lt;filter&gt;${project.build.directory}/generated-test-sources/jpa-maven-plugin/entityClassnames.properties&lt;/filter&gt;
        &lt;/filters&gt;
        &lt;outputDirectory&gt;${project.build.testOutputDirectory}/META-INF&lt;/outputDirectory&gt;
        &lt;resources&gt;
          &lt;resource&gt;
            &lt;filtering&gt;true&lt;/filtering&gt;
            &lt;directory&gt;src/test/resources/META-INF&lt;/directory&gt;
            &lt;includes&gt;
              &lt;include&gt;persistence.xml&lt;/include&gt;
            &lt;/includes&gt;
          &lt;/resource&gt;
        &lt;/resources&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>

<p>Run <code>mvn clean process-test-classes</code> if you just want to see the
effects of the <code>jpa-maven-plugin</code>.  Look in your
<code>target/test-classes/META-INF</code> directory.  You will see a
<code>persistence.xml</code> file with all of your entity and mapped superclass
and embeddables and id classes listed.  Any Maven lifecycle phases
that occur before <code>process-test-classes</code> will not be able to use the
effects of the <code>jpa-maven-plugin</code>.</p>

<h2>More Information</h2>

<p>For more information, grab the source to this project, and from the root directory run:</p>

<pre><code>mvn clean install site
</code></pre>

<p>Full documentation will be available at <code>target/site/index.html</code>.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/ljnelson">ljnelson</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>